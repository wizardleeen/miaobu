---
title: 部署生命周期
description: 了解秒部部署的完整状态流转过程。
---

每次部署都会经历一系列状态变化。了解这些状态有助于你更好地使用 API 管理部署。

## 状态流转

```
queued → cloning → building → uploading → deploying → deployed
                                                        ↓
                                                      purged
```

任何阶段都可能转为 `failed` 或 `cancelled`。

## 状态说明

| 状态 | 说明 |
|------|------|
| `queued` | 部署已创建，等待构建系统处理 |
| `cloning` | 正在从 GitHub 克隆仓库代码 |
| `building` | 正在安装依赖并执行构建命令 |
| `uploading` | 正在将构建产物上传到云端存储 |
| `deploying` | 正在更新边缘网络路由（通常 < 2 秒） |
| `deployed` | 部署成功，可通过 URL 访问 |
| `failed` | 部署失败，查看 `error_message` 获取详情 |
| `cancelled` | 部署被用户取消 |
| `purged` | 部署记录保留但构建产物已清理 |

## 自动清理

系统会自动清理旧的部署产物：

- 保留最近 **3 个** 成功部署的构建产物
- 被自定义域名引用的部署不会被清理
- 清理后部署记录保留（状态变为 `purged`），但无法回滚到该版本

## 超时处理

如果部署在 20 分钟内未完成，系统会自动将其标记为 `failed`。

## 回滚

通过 API 回滚到历史部署时：

- 目标部署必须处于 `deployed` 状态（非 `purged`）
- 不能回滚到当前活跃的部署
- 回滚期间不能有其他正在进行的部署
- 对于静态站点，回滚仅切换路由（毫秒级）
- 对于后端应用，回滚会更新云端函数（约 300 毫秒，零停机）
